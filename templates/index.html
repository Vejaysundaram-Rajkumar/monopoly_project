<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Menu</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        header {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 1em;
        }

        main {
            max-width: 800px;
            margin: 2em auto;
            text-align: center;
        }

        .options {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 2em;
        }

        .option {
            background-color: #3498db;
            color: #fff;
            padding: 1em;
            width: 200px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            margin: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
        }

        .option:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        /* Overlay styles */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .form-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        button.next {
            margin-top: 10px;
        }
        .form-container input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Style for the "Next" button */
        .form-container button.next {
            background-color: #3498db;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
        }

        .form-container button.next:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        /* Style for the "Submit" button */
        .form-container button.submit {
            background-color: #2ecc71;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
        }

        .form-container button.submit:hover {
            background-color: #27ae60;
            transform: scale(1.05);
        }

    </style>
</head>
<body>

    <header>
        <h1>Game Menu</h1>
    </header>

    <main>
        <div class="options">
            <button class="option" onclick="showOverlay()">New Game</button>
            <button class="option" onclick="deleteGame()">Delete the saved game</button>
            <button class="option" onclick="location.href='/manager'">Continue Game</button>
            
        </div>
    </main>

    <!-- Overlay -->
    <div id="overlay" class="overlay">
        <div class="form-container">
            <div class="step" id="step1">
                <h2>Step 1</h2>
                <label for="numPlayers">Select Number of Players:</label>
                <select id="numPlayers" name="numPlayers">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
                <button class="next" onclick="nextStep()">Next</button>
            </div>
            <div class="step" id="step2">
                <h2>Step 2</h2>
                <p>Enter the names of the players:</p>
                <div id="playerNames"></div>
                <button class="next" onclick="nextStep()">Next</button>
            </div>
            <div class="step" id="step3">
                <h2>Step 3</h2>
                <p>Give a name to the game :</p>
                <input type="text" id="gamename"></input>
                <button class="next" onclick="submitForm()">Submit</button>
            </div>
            
        </div>
    </div>

    <script>


function deleteGame() {
    var txt;
    if (confirm("Are you sure you want to delete the game saved?")) {
    txt = 1;
    } else {
    txt = 0;
    }
    if(txt == 1) {
    // Make an AJAX request to Flask
    $.ajax({
        type: 'POST',
        url: '/deletegame',
        contentType: 'application/json;charset=UTF-8',
        data: JSON.stringify({
           txt:txt 
        }),
        success: function (data) {
            if (data.status === 'error' && data.message === 'no game found') {
                const errorMessage = encodeURIComponent("No saved games to be deleted");
                window.location.href = `/error?status=No%20SavedGames&message=${errorMessage}`;
                
            } else if(data.status === 'success' ){

                alert('Game deleted sucessfully!!');    
                
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            // Redirect or handle the error as needed
            console.error('Error:', errorThrown);
        }
    });

}
}

    function showOverlay() {
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('step1').classList.add('active');
    }

    function nextStep() {
        const activeStep = document.querySelector('.step.active');
        const nextStep = activeStep.nextElementSibling;

        // Validate input before proceeding to the next step
        if (validateStep(activeStep)) {
            activeStep.classList.remove('active');
            if (nextStep) {
                nextStep.classList.add('active');
                // If it's the second step, dynamically generate input fields for player names
                if (nextStep.id === 'step2') {
                    const numPlayers = document.getElementById('numPlayers').value;
                    generatePlayerNameFields(numPlayers);
                }
            } else {
                document.getElementById('overlay').style.display = 'none';
            }
        }
    }

    function validateStep(step) {
        const inputs = step.querySelectorAll('input');
        for (const input of inputs) {
            if (input.required && !input.value.trim()) {
                alert('Please fill out all required fields.');
                return false;
            }
        }
         // Additional check for Step 3 (gamename)
    if (step.id === 'step3') {
        const gamenameInput = document.getElementById('gamename');
        if (gamenameInput.required && !gamenameInput.value.trim()) {
            alert('Please fill out all required fields.');
            return false;
        }
    }

    return true;
}
    function generatePlayerNameFields(numPlayers) {
        const playerNamesContainer = document.getElementById('playerNames');
        playerNamesContainer.innerHTML = '';

        for (let i = 1; i <= numPlayers; i++) {
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `Player ${i} Name`;
            input.name = `player${i}`;
            input.required = true; // Make player names required
            playerNamesContainer.appendChild(input);
        }
    }

    function submitForm() {
    if (validateStep(document.getElementById('step3'))) {
        // Handle form submission here
        const gamename = document.getElementById('gamename').value;
        const numPlayers = document.getElementById('numPlayers').value;
        const playerNames = [];
        for (let i = 1; i <= numPlayers; i++) {
            const playerName = document.getElementsByName(`player${i}`)[0].value;
            playerNames.push(playerName);
        }

        // Use AJAX or another method to send the data to the Flask server
        // Here, I'm using a simple form submission for demonstration
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/submit';

        // Include numPlayers in the form data
        const numPlayersInput = document.createElement('input');
        numPlayersInput.type = 'hidden';
        numPlayersInput.name = 'numPlayers';
        numPlayersInput.value = numPlayers;
        form.appendChild(numPlayersInput);

        const gamenameInput = document.createElement('input');
        gamenameInput.type = 'hidden';
        gamenameInput.name = 'gamename';
        gamenameInput.value = gamename;
        form.appendChild(gamenameInput);

        for (let i = 0; i < numPlayers; i++) {
            const playerNameInput = document.createElement('input');
            playerNameInput.type = 'hidden';
            playerNameInput.name = `player${i + 1}`;
            playerNameInput.value = playerNames[i];
            form.appendChild(playerNameInput);
        }

        document.body.appendChild(form);
        form.submit();
    }
}

    </script>

</body>
</html>
